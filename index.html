<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ZUZUCOIN — Pre-Sale • Stake • NFT Rewards</title>
<meta name="theme-color" content="#0e1522" />
<meta http-equiv="X-Content-Type-Options" content="nosniff" />
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
<meta http-equiv="X-Frame-Options" content="SAMEORIGIN" />

<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<link rel="stylesheet" href="style.css" />

<!-- CountDown hedefi (İstanbul): 5 Kasım 2025 13:00 -->
<script>window.LAUNCH_AT_ISO="2025-11-05T13:00:00+03:00";</script>

<!-- Solana kütüphaneleri -->
<script defer src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.3/lib/index.iife.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/@solana/spl-token@0.4.6/lib/index.iife.min.js" crossorigin="anonymous"></script>

<!-- Küçük modal stilleri (genel stile dokunmadan) -->
<style>
  .z-modal-back{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(2px);display:none;align-items:center;justify-content:center;z-index:999}
  .z-modal{width:min(520px,92%);background:#111b2d;border:1px solid #1b2a49;border-radius:16px;padding:12px 12px 8px}
  .z-modal h3{margin:.2rem .4rem .6rem}
  .z-list{display:grid;gap:8px;margin:8px 0}
  .z-list button{width:100%;border:1px solid #23395d;background:#0f1c33;color:#e8f1ff;border-radius:12px;padding:.9rem;font-weight:800}
  .z-row{display:flex;gap:8px;flex-wrap:wrap}
  .muted-sm{color:#9cb6e6;font-size:.9rem}
  .hide{display:none!important}
  /* eski EVM kutusunu tamamen kaldırıyoruz */
  .presale .z-container > .card:first-of-type{display:none!important}
</style>
</head>

<body>
<!-- NAV -->
<header class="z-nav">
  <div class="z-container z-nav-inner">
    <a class="brand" href="#"><img src="assets/images/logo.png" alt="ZUZU"><span>ZUZUCOIN</span></a>
    <nav class="z-menu">
      <a href="#presale" data-i="nav_presale">Ön Satış</a>
      <a href="#stake" data-i="nav_stake">Stake</a>
      <a href="#nft" data-i="nav_nft">NFT Ödülleri</a>
      <a href="#roadmap" data-i="nav_roadmap">Yol Haritası</a>
      <a href="#tokenomics" data-i="nav_token">Tokonomi</a>
      <a href="stake-simulator.html" class="z-chip">Stake Simulator ↗</a>
      <a href="claim.html" class="z-chip">Claim Portal ↗</a>
      <select id="langSel" class="lang">
        <option value="tr" selected>TR</option>
        <option value="en">EN</option>
      </select>
      <button id="connectBtn" class="z-btn z-btn-primary" data-i="connect">Cüzdan Bağla</button>
    </nav>
  </div>
</header>

<main>
<!-- HERO -->
<section class="z-section hero-2">
  <div class="z-container grid-2">
    <div>
      <div class="badge" data-i="hero_badge">Ön Satış • Stake ile NFT Kazan</div>
      <h1 data-i="hero_title">ZUZU — Geleceğin Robotic Kirpisi 🦔⚡</h1>
      <p class="lead" data-i="hero_lead">Stake et ve <b>ZUZU Maskot NFT</b> kazan. Sınırlı arz, yüksek <b>utility</b>.</p>
      <div class="hero-cta">
        <a href="#stake" class="z-btn z-btn-primary" data-i="cta_stake">Stake Etmeye Başla</a>
        <a href="#nft" class="z-btn z-btn-ghost" data-i="cta_nft">NFT Ödülleri</a>
      </div>
      <div class="z-chip-row">
        <a id="thirdwebNFTRoute" class="z-chip" href="#" target="_blank" rel="noopener" data-i="collection_page">Koleksiyon Sayfası</a>
        <span class="z-chip" data-i="contract">Kontrat:</span>
        <span class="z-chip" id="contractDisplay">—</span>
      </div>
      <div class="counter" style="margin-top:14px">
        <div class="flip"><div id="cdDays" class="num">00</div><small data-i="days">GÜN</small></div>
        <div class="flip"><div id="cdHours" class="num">00</div><small data-i="hours">SAAT</small></div>
        <div class="flip"><div id="cdMins" class="num">00</div><small data-i="mins">DAKİKA</small></div>
        <div class="flip"><div id="cdSecs" class="num">00</div><small data-i="secs">SANİYE</small></div>
      </div>
    </div>
    <div class="hero-visual"><img id="zuzuLogo" class="logo-big" src="assets/images/branding/zuzu-logo.svg" alt="ZUZU Logo" onerror="this.onerror=null;this.src='assets/images/branding/zuzu-logo.png'"></div>
  </div>
</section>

<!-- PRESALE (sadece Solana) -->
<section id="presale" class="z-section presale">
  <div class="z-container">
    <div class="section-head">
      <h2 data-i="presale_title">Ön Satış — Geri Sayım</h2>
      <p data-i="presale_lead">ZUZU ön satışına hazır ol! <b>Sınırlı tahsis</b>, topluluğa özel fiyat.</p>
    </div>

    <div class="card">
      <h3>Solana Wallet</h3>
      <div class="z-row">
        <button id="btnConnect" class="z-btn z-btn-primary">Cüzdan Bağla</button>
        <button id="btnDisconnect" class="z-btn z-btn-ghost">Disconnect</button>
        <div id="status" class="muted-sm">Durum: Hazır (cüzdan bekleniyor)</div>
      </div>

      <div class="z-row" style="margin-top:10px">
        <div style="flex:1">
          <label>SOL ile satın al</label>
          <input id="amountSOL" class="input" placeholder="0.10" inputmode="decimal" />
        </div>
        <div><button id="sendSOL" class="z-btn z-btn-primary">SOL Gönder</button></div>
      </div>

      <div class="z-row" style="margin-top:8px">
        <div style="flex:1">
          <label>USDT (SPL) ile satın al</label>
          <input id="amountUSDT" class="input" placeholder="25" inputmode="decimal" />
        </div>
        <div><button id="sendUSDT" class="z-btn z-btn-primary">USDT Gönder</button></div>
      </div>

      <div class="z-row" style="margin-top:10px">
        <div class="muted-sm">Wallet: <b id="walletState">Not connected</b></div>
      </div>

      <div style="margin-top:10px">
        <label>Referral (Invite & Earn)</label>
        <div class="z-row">
          <input id="refLink" class="input" readonly />
          <button id="copyRef" class="z-btn z-btn-ghost">Copy Link</button>
          <button id="shareRef" class="z-btn z-btn-ghost">Share</button>
        </div>
      </div>
    </div>

    <!-- Haftalara göre fiyat bilgisi (butonlar USDT inputunu doldurur) -->
    <div class="presale-grid">
      <div class="card buybox"><h4 data-i="w1">1. Hafta (En Ucuz)</h4>
        <div class="price">1 ZUZU = <b id="p0">0.0050</b> USDT</div>
        <div class="cost"><span data-i="cost">Maliyet:</span> <b id="c0">0</b> USDT</div>
        <div class="buy"><button class="z-btn z-btn-primary" data-week="0" id="buyW0" data-i="buy">Satın Al</button><button class="z-btn z-btn-ghost">Detay</button></div>
      </div>
      <div class="card buybox"><h4 data-i="w2">2. Hafta</h4>
        <div class="price">1 ZUZU = <b id="p1">0.0065</b> USDT</div>
        <div class="cost"><span data-i="cost">Maliyet:</span> <b id="c1">0</b> USDT</div>
        <div class="buy"><button class="z-btn z-btn-primary" data-week="1" id="buyW1" data-i="buy">Satın Al</button><button class="z-btn z-btn-ghost">Detay</button></div>
      </div>
      <div class="card buybox"><h4 data-i="w3">3. Hafta</h4>
        <div class="price">1 ZUZU = <b id="p2">0.0080</b> USDT</div>
        <div class="cost"><span data-i="cost">Maliyet:</span> <b id="c2">0</b> USDT</div>
        <div class="buy"><button class="z-btn z-btn-primary" data-week="2" id="buyW2" data-i="buy">Satın Al</button><button class="z-btn z-btn-ghost">Detay</button></div>
      </div>
      <div class="card buybox"><h4 data-i="w4">4. Hafta (Son Fırsat)</h4>
        <div class="price">1 ZUZU = <b id="p3">0.0100</b> USDT</div>
        <div class="cost"><span data-i="cost">Maliyet:</span> <b id="c3">0</b> USDT</div>
        <div class="buy"><button class="z-btn z-btn-primary" data-week="3" id="buyW3" data-i="buy">Satın Al</button><button class="z-btn z-btn-ghost">Detay</button></div>
      </div>
    </div>

    <!-- Borsa logoları ticker (eski görseller) -->
    <div class="card" style="margin-top:16px">
      <h3 style="margin:0 0 10px" data-i="exchanges">Desteklenen Borsalar</h3>
      <div class="ticker">
        <div class="ticker__track" id="exTrack">
          <div class="ticker__item"><img src="assets/images/exchanges/gateio.png" alt="gate" loading="lazy"></div>
          <div class="ticker__item"><img src="assets/images/exchanges/kucoin.png" alt="kucoin" loading="lazy"></div>
          <div class="ticker__item"><img src="assets/images/exchanges/okx.png" alt="okx" loading="lazy"></div>
          <div class="ticker__item"><img src="assets/images/exchanges/mxc.png" alt="mexc" loading="lazy"></div>
          <div class="ticker__item"><img src="assets/images/exchanges/bitmart.png" alt="bitmart" loading="lazy"></div>
          <div class="ticker__item"><img src="assets/images/exchanges/bybit.png" alt="bybit" loading="lazy"></div>
          <!-- loop tekrarları -->
          <div class="ticker__item"><img src="assets/images/exchanges/gateio.png" alt=""></div>
          <div class="ticker__item"><img src="assets/images/exchanges/kucoin.png" alt=""></div>
          <div class="ticker__item"><img src="assets/images/exchanges/okx.png" alt=""></div>
          <div class="ticker__item"><img src="assets/images/exchanges/mxc.png" alt=""></div>
          <div class="ticker__item"><img src="assets/images/exchanges/bitmart.png" alt=""></div>
          <div class="ticker__item"><img src="assets/images/exchanges/bybit.png" alt=""></div>
        </div>
      </div>
      <div class="ex-note">Will Be Listed Soon</div>
    </div>
  </div>
</section>

<!-- STAKE (kısa) -->
<section id="stake" class="z-section">
  <div class="z-container">
    <div class="section-head">
      <h2 data-i="stake_title">Stake Pro — Kilitle, Kazan, NFT Kap ✨</h2>
      <p data-i="stake_lead">ZUZU’larını kilitle, <b>APY + NFT BOOST</b> ile pasif gelir elde et.</p>
    </div>
    <div class="stake-grid">
      <div class="stake-card"><div class="tier">Bronze</div><ul><li>30 days lock</li><li><b>12% APY</b></li><li>Early access raffles</li></ul></div>
      <div class="stake-card"><div class="tier silver">Silver</div><ul><li>90 days lock</li><li><b>24% APY</b></li><li>+5% NFT boost</li></ul></div>
      <div class="stake-card"><div class="tier gold">Gold</div><ul><li>180 days lock</li><li><b>40% APY</b></li><li>Whitelist + ZUZU badge</li></ul></div>
      <div class="stake-card"><div class="tier diamond">Diamond</div><ul><li>365 days lock</li><li><b>65% APY</b></li><li>+10% NFT boost</li></ul></div>
      <div class="stake-card"><div class="tier obsidian">Obsidian</div><ul><li>540 days lock</li><li><b>85% APY</b></li><li>VIP rewards + airdrop priority</li></ul></div>
    </div>
  </div>
</section>

<!-- NFT REWARDS (grid) -->
<section id="nft" class="z-section">
  <div class="z-container">
    <div class="section-head">
      <h2>ZUZU Maskot NFT Ödülleri 🎁</h2>
      <p>Stakers nadir NFT’ler kazanır. Kontrat: <code id="contractDisplay2"></code> •
      <a id="thirdwebNFTRoute2" href="#" target="_blank" rel="noopener">Koleksiyon sayfası</a></p>
    </div>
    <div class="nft-grid" id="nftGrid"></div>
  </div>
</section>

<!-- TOKENOMICS -->
<section id="tokenomics" class="z-section">
  <div class="z-container">
    <div class="section-head">
      <h2 data-i="token_title">Tokonomi (Görselleştirilmiş)</h2>
      <p class="muted">Toplam Arz: 500,000,000 ZUZU</p>
    </div>
    <div class="card tk">
      <div>
        <svg viewBox="0 0 42 42" width="100%" style="max-width:360px">
          <circle cx="21" cy="21" r="15.915" fill="#0e172a"/>
          <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#8E69FF" stroke-width="6" stroke-dasharray="35 65" stroke-dashoffset="25"></circle>
          <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#23d4e1" stroke-width="6" stroke-dasharray="20 80" stroke-dashoffset="-10"></circle>
          <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#47cc6f" stroke-width="6" stroke-dasharray="15 85" stroke-dashoffset="-30"></circle>
          <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#ffaa3a" stroke-width="6" stroke-dasharray="10 90" stroke-dashoffset="-45"></circle>
          <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#d07bff" stroke-width="6" stroke-dasharray="15 85" stroke-dashoffset="-60"></circle>
          <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#ff6a6a" stroke-width="6" stroke-dasharray="5 95" stroke-dashoffset="-75"></circle>
          <text x="21" y="21" text-anchor="middle" fill="#e9f2ff" font-size="3.2" font-weight="800">500,000,000</text>
          <text x="21" y="26" text-anchor="middle" fill="#9fb4dd" font-size="2.4">Total Supply</text>
        </svg>
      </div>
      <div class="legend">
        <div><span class="dot" style="background:#8E69FF"></span><span>Community — 35%</span></div>
        <div><span class="dot" style="background:#23d4e1"></span><span>Liquidity — 20%</span></div>
        <div><span class="dot" style="background:#47cc6f"></span><span>Team (12m lock) — 15%</span></div>
        <div><span class="dot" style="background:#ffaa3a"></span><span>Treasury — 10%</span></div>
        <div><span class="dot" style="background:#d07bff"></span><span>Staking Rewards — 15%</span></div>
        <div><span class="dot" style="background:#ff6a6a"></span><span>Partners — 5%</span></div>
      </div>
    </div>
  </div>
</section>

<!-- ROADMAP -->
<section id="roadmap" class="z-section">
  <div class="z-container">
    <div class="section-head"><h2 data-i="road_title">Yol Haritası</h2>
      <p data-i="road_lead">Topluluk, staking, NFT drop’ları ve listelemelere odaklı plan.</p></div>
    <div class="card">
      <ul>
        <li><b>Q1 — Core Setup</b>: Web, contract tests, community channels, security.</li>
        <li><b>Q2 — Pre-Sale & Stake</b>: Sale rounds, staking launch, Maskot NFT rewards.</li>
        <li><b>Q3 — Listings</b>: Liquidity, first CEX/DEX listings, market-maker.</li>
        <li><b>Q4 — Ecosystem</b>: In-game integrations, partnerships, mobile mini-app.</li>
      </ul>
    </div>
  </div>
</section>
</main>

<footer class="z-footer">
  <div class="z-container between center-v">
    <small>© ZUZUCOIN 2025</small>
    <div class="z-chip-row">
      <a class="z-chip" href="#presale">Ön Satış</a>
      <a class="z-chip" href="#stake">Stake</a>
      <a class="z-chip" href="#nft">NFT</a>
      <a class="z-chip" href="#tokenomics">Tokonomi</a>
    </div>
  </div>
</footer>

<!-- ====== UYGULAMA JS (tek blok) ====== -->
<script>
/* ========= Global Config ========= */
const CFG = {
  // Alıcı (senin SOL adresin)
  ownerSol: "3HvtSR8g1nV...REPLACE_ME",       // <-- BURAYA kendi Solana (SOL) adresini koy
  // USDT (SPL) mint (mainnet)
  usdtMint: "Es9vMFrzaCERMfYMgANJwWaJ3WmZ5eWQGj1iG3Vr3yY", // USDT (SPL) - mainnet. Kaynak: Solana token list. 
  // NFT linkleri + kontrat
  contractAddress:"0xF2bbbEcB417725813BF5E940d678793fACDa9729",
  collectionUrl:"https://thirdweb.com/team/enejomble35/Zuzu-Maskot-Drop-28b60a/contract/polygon/0xF2bbbEcB417725813BF5E940d678793fACDa9729/nfts",
  // Presale fiyatları
  weekPrices:[0.0050,0.0065,0.0080,0.0100],
  // NFT grid
  nfts:[
    { id:0, name:"ZUZU Hero", rarity:"Epic", supply:200 },
    { id:1, name:"ZUZU Rogue", rarity:"Rare", supply:2500 },
    { id:2, name:"ZUZU Berserker", rarity:"Epic", supply:800 },
    { id:3, name:"ZUZU Hacker", rarity:"Rare", supply:600 },
    { id:4, name:"ZUZU Sorceress", rarity:"Epic", supply:750 },
    { id:5, name:"ZUZU Warrior", rarity:"Rare", supply:900 },
    { id:6, name:"ZUZU Maiden", rarity:"Rare", supply:1100 },
    { id:7, name:"ZUZU Ranger", rarity:"Rare", supply:1000 },
    { id:8, name:"ZUZU Scientist", rarity:"Epic", supply:1100 },
    { id:9, name:"ZUZU Titan", rarity:"Legendary", supply:250 },
  ]
};

/* ========= i18n (TR / EN) ========= */
const I = {
 tr:{nav_presale:"Ön Satış",nav_stake:"Stake",nav_nft:"NFT Ödülleri",nav_roadmap:"Yol Haritası",nav_token:"Tokonomi",connect:"Cüzdan Bağla",
     hero_badge:"Ön Satış • Stake ile NFT Kazan",hero_title:"ZUZU — Geleceğin Robotic Kirpisi 🦔⚡",
     hero_lead:"Stake et ve <b>ZUZU Maskot NFT</b> kazan. Sınırlı arz, yüksek <b>utility</b>.",
     cta_stake:"Stake Etmeye Başla",cta_nft:"NFT Ödülleri",collection_page:"Koleksiyon Sayfası",contract:"Kontrat:",
     days:"GÜN",hours:"SAAT",mins:"DAKİKA",secs:"SANİYE",
     presale_title:"Ön Satış — Geri Sayım",presale_lead:"ZUZU ön satışına hazır ol! <b>Sınırlı tahsis</b>, topluluğa özel fiyat.",
     w1:"1. Hafta (En Ucuz)",w2:"2. Hafta",w3:"3. Hafta",w4:"4. Hafta (Son Fırsat)",cost:"Maliyet:",buy:"Satın Al",exchanges:"Desteklenen Borsalar",
     stake_title:"Stake Pro — Kilitle, Kazan, NFT Kap ✨",stake_lead:"ZUZU’larını kilitle, <b>APY + NFT BOOST</b> ile pasif gelir elde et.",
     token_title:"Tokonomi (Görselleştirilmiş)",road_title:"Yol Haritası",road_lead:"Topluluk, staking, NFT drop’ları ve listelemelere odaklı plan."},
 en:{nav_presale:"Pre-Sale",nav_stake:"Stake",nav_nft:"NFT Rewards",nav_roadmap:"Roadmap",nav_token:"Tokenomics",connect:"Connect Wallet",
     hero_badge:"Pre-Sale • Stake to Win NFT",hero_title:"ZUZU — Robotic Hedgehog 🦔⚡",
     hero_lead:"Stake and win <b>ZUZU Maskot NFT</b>. Limited supply, high <b>utility</b>.",
     cta_stake:"Start Staking",cta_nft:"NFT Rewards",collection_page:"Collection Page",contract:"Contract:",
     days:"DAYS",hours:"HOURS",mins:"MINUTES",secs:"SECONDS",
     presale_title:"Pre-Sale — Countdown",presale_lead:"Get ready for ZUZU pre-sale! <b>Limited allocation</b>, community price.",
     w1:"Week 1 (Cheapest)",w2:"Week 2",w3:"Week 3",w4:"Week 4 (Last Chance)",cost:"Cost:",buy:"Buy",exchanges:"Supported Exchanges",
     stake_title:"Stake Pro — Lock, Earn, Get NFT ✨",stake_lead:"Lock your ZUZU, earn <b>APY + NFT BOOST</b>.",
     token_title:"Tokenomics (Visualized)",road_title:"Roadmap",road_lead:"Plan focused on community, staking, NFT drops, listings."}
};
function applyLang(lang="tr"){
  document.querySelectorAll("[data-i]").forEach(el=>{
    const k = el.getAttribute("data-i");
    if (I[lang] && I[lang][k]) el.innerHTML = I[lang][k];
  });
}
document.getElementById("langSel")?.addEventListener("change", e=>applyLang(e.target.value));
applyLang("tr");

/* ========= NFT Grid render ========= */
(function renderNFTs(){
  const g=document.getElementById("nftGrid"); if(!g) return;
  let html="";
  CFG.nfts.forEach(n=>{
    const img=`assets/images/mask/${n.id}.png`;
    const link=`${CFG.collectionUrl}?tokenId=${n.id}`;
    html+=`<div class="nft">
      <img src="${img}" alt="${n.name}" loading="lazy"
           style="aspect-ratio:1/1;object-fit:contain;background:#0f1a30;padding:8px;border-bottom:1px solid #1d2d50"
           onerror="this.style.display='none'">
      <div class="meta"><div><b>${n.name}</b>
        <div style="color:#9fb6e6;font-size:.9rem">Supply: ${n.supply.toLocaleString()}</div></div>
        <span class="tag">${n.rarity}</span></div>
      <a class="z-btn z-btn-ghost" style="margin:0 10px 10px" href="${link}" target="_blank" rel="noopener">View ↗</a>
    </div>`;
  });
  g.innerHTML=html;
})();

/* ========= Link & Kontrat yazıları ========= */
(function setupLinks(){
  const c=CFG.contractAddress;
  const short=`${c.slice(0,6)}...${c.slice(-4)}`;
  const cd=document.getElementById("contractDisplay");
  const cd2=document.getElementById("contractDisplay2");
  if(cd)cd.textContent=short; if(cd2)cd2.textContent=c;
  const t1=document.getElementById("thirdwebNFTRoute");
  const t2=document.getElementById("thirdwebNFTRoute2");
  if(t1)t1.href=CFG.collectionUrl; if(t2)t2.href=CFG.collectionUrl;
})();

/* ========= Countdown (sabit tarih) ========= */
(function countdown(){
  const target=new Date(window.LAUNCH_AT_ISO).getTime();
  function tick(){
    const left=Math.max(0, target - Date.now());
    const d=Math.floor(left/86400000);
    const h=Math.floor((left%86400000)/3600000);
    const m=Math.floor((left%3600000)/60000);
    const s=Math.floor((left%60000)/1000);
    const pad=n=>n.toString().padStart(2,"0");
    ["cdDays","cdHours","cdMins","cdSecs"].forEach((id,i)=>{
      const v=[d,h,m,s][i]; const el=document.getElementById(id);
      if(el && el.textContent!==pad(v)) el.textContent=pad(v);
    });
  }
  tick(); setInterval(tick,1000);
})();

/* ========= Presale — maliyet kutuları ========= */
(function costs(){
  const input=document.createElement('input'); input.id="buyAmountTmp"; input.value="10000"; // referans: 10k ZUZU
  function update(){
    const qty=10000; // örnek hesap kutuları için
    CFG.weekPrices.forEach((p,i)=>{
      const cost=qty*p;
      const priceEl=document.getElementById("p"+i);
      const costEl=document.getElementById("c"+i);
      if(priceEl)priceEl.textContent=p.toFixed(4);
      if(costEl)costEl.textContent=cost.toLocaleString();
    });
  }
  ["p0","p1","p2","p3"].forEach(()=>{}); update();
  ["buyW0","buyW1","buyW2","buyW3"].forEach((id,i)=>{
    const b=document.getElementById(id); if(!b) return;
    b.addEventListener("click", ()=>{
      // 10,000 ZUZU varsayımı ile USDT inputunu doldur
      const cost=(10000*CFG.weekPrices[i]).toFixed(2);
      document.getElementById("amountUSDT").value=cost;
      document.getElementById("amountUSDT").focus();
    });
  });
})();

/* ========= Referral link ========= */
(function referral(){
  const u=new URL(location.href);
  const my=u.origin+u.pathname+(u.search?u.search:"");
  const ref=document.getElementById("refLink");
  if(ref) ref.value = my + (u.search.includes("ref=") ? "" : (u.search?"&":"?")+"ref=") + (localStorage.getItem("zref")||makeId());
  function makeId(){ const s=Math.random().toString(36).slice(2,8); localStorage.setItem("zref",s); return s; }
  document.getElementById("copyRef")?.addEventListener("click", async()=>{
    try{ await navigator.clipboard.writeText(ref.value); alert("Kopyalandı!"); }catch{ alert("Kopyalanamadı"); }
  });
  document.getElementById("shareRef")?.addEventListener("click", async()=>{
    try{
      if(navigator.share){ await navigator.share({title:"ZUZUCOIN",text:"Join ZUZU!",url:ref.value}); }
      else{ await navigator.clipboard.writeText(ref.value); alert("Link kopyalandı."); }
    }catch(e){}
  });
})();

/* ========= Wallet Modal ========= */
const modal = (function(){
  const back=document.createElement("div"); back.className="z-modal-back"; back.id="walletModal";
  back.innerHTML=`<div class="z-modal">
      <h3>Cüzdan Seç</h3>
      <div class="z-list">
        <button data-w="phantom">Phantom</button>
        <button data-w="solflare">Solflare</button>
        <button data-w="backpack">Backpack</button>
      </div>
      <div class="muted-sm">Masaüstünde: Phantom / Solflare / Backpack eklentisiyle doğrudan bağlanır.<br>
      Telefonda: Cüzdanın içindeki tarayıcıda açılır, orada “Bağlan” onayı gelir.</div>
      <div style="margin-top:8px"><button id="mclose" class="z-btn z-btn-ghost" style="width:100%">Kapat</button></div>
    </div>`;
  document.body.appendChild(back);
  back.addEventListener("click",e=>{ if(e.target===back) back.style.display="none"; });
  back.querySelector("#mclose").onclick=()=>back.style.display="none";
  return {
    show(){ back.style.display="flex"; },
    on(cb){ back.querySelectorAll("button[data-w]").forEach(b=>b.onclick=()=>cb(b.getAttribute("data-w"))); }
  }
})();

/* ========= Solana Connect/Send ========= */
let provider=null, walletPubkey=null, connection=null;

function detectProvider(){
  if(window.solana?.isPhantom) return window.solana;        // Phantom ext / in-app
  if(window.backpack?.solana) return window.backpack.solana; // Backpack
  if(window.solflare?.isSolflare) return window.solflare;    // Solflare ext / in-app
  return null;
}

async function connectAuto(){
  provider = detectProvider();
  if(provider){
    try{
      const res = await provider.connect();
      walletPubkey = (res.publicKey||res).toString?.() || provider.publicKey?.toString?.();
      afterConnect();
      return true;
    }catch(e){ console.warn(e); return false; }
  }else{
    // Mobil tarayıcı – cüzdan yok: modal aç
    modal.show();
    return false;
  }
}

function afterConnect(){
  const btn=document.getElementById("connectBtn");
  const btn2=document.getElementById("btnConnect");
  const wlab=document.getElementById("walletState");
  const status=document.getElementById("status");
  const short = walletPubkey ? walletPubkey.slice(0,4)+"…"+walletPubkey.slice(-4) : "—";
  if(btn) btn.textContent = short;
  if(btn2) btn2.textContent = short;
  if(wlab) wlab.textContent = "Connected";
  if(status) status.textContent = "Durum: Bağlandı";
}

async function disconnect(){
  try{ await provider?.disconnect?.(); }catch{}
  walletPubkey=null; provider=null;
  document.getElementById("connectBtn").textContent = I.tr.connect;
  document.getElementById("btnConnect").textContent = I.tr.connect;
  document.getElementById("walletState").textContent="Not connected";
  document.getElementById("status").textContent="Durum: Hazır (cüzdan bekleniyor)";
}

function openInWallet(app){ // deep-link “browse” (resmi yöntem)
  const url = encodeURIComponent(location.href.split('#')[0]);
  const ref = encodeURIComponent(location.origin);
  let deeplink="";
  if(app==="phantom")   deeplink=`https://phantom.app/ul/browse/${url}?ref=${ref}`;         // Phantom browse. Kaynak dokümantasyon. 2
  if(app==="solflare")  deeplink=`https://solflare.com/ul/v1/browse?url=${url}&ref=${ref}`; // Solflare browse. 3
  if(app==="backpack")  deeplink=`https://backpack.app/ul/browse/${url}`;                   // Backpack’in injection’ı mevcut; browse için genel şema.
  location.href = deeplink;
}

modal.on(async (w)=>{
  // masaüstünde extension varsa direkt bağlan; yoksa cüzdanın içinde aç
  const hasExt = !!detectProvider();
  if(hasExt){ modal.show(); await connectAuto(); document.getElementById("walletModal").style.display="none"; }
  else{ openInWallet(w); }
});

document.getElementById("connectBtn")?.addEventListener("click", ()=>modal.show());
document.getElementById("btnConnect")?.addEventListener("click", ()=>modal.show());
document.getElementById("btnDisconnect")?.addEventListener("click", disconnect);

// Solana RPC
function getConn(){ return connection || (connection = new solanaWeb3.Connection("https://api.mainnet-beta.solana.com","confirmed")); }

// SOL gönder
async function sendSOL(){
  if(!provider && !await connectAuto()) return;
  const amount=parseFloat((document.getElementById("amountSOL").value||"0").toString().replace(/[^\d.]/g,""))||0;
  if(amount<=0) return alert("Geçerli SOL miktarı gir.");
  const from = new solanaWeb3.PublicKey(walletPubkey);
  const to   = new solanaWeb3.PublicKey(CFG.ownerSol);
  const lamports = Math.round(amount * solanaWeb3.LAMPORTS_PER_SOL);
  const tx = new solanaWeb3.Transaction().add(
    solanaWeb3.SystemProgram.transfer({fromPubkey:from, toPubkey:to, lamports})
  );
  tx.feePayer = from;
  tx.recentBlockhash = (await getConn().getLatestBlockhash()).blockhash;
  const signed = await provider.signAndSendTransaction(tx);
  alert("Gönderildi! TX: "+(signed.signature||signed));
}

// USDT (SPL) gönder
async function sendUSDT(){
  if(!provider && !await connectAuto()) return;
  const amount=parseFloat((document.getElementById("amountUSDT").value||"0").toString().replace(/[^\d.]/g,""))||0;
  if(amount<=0) return alert("Geçerli USDT miktarı gir.");
  const fromPk = new solanaWeb3.PublicKey(walletPubkey);
  const toPk   = new solanaWeb3.PublicKey(CFG.ownerSol);
  const mint   = new solanaWeb3.PublicKey(CFG.usdtMint);

  const fromAta = await splToken.getAssociatedTokenAddress(mint, fromPk);
  const toAta   = await splToken.getAssociatedTokenAddress(mint, toPk, false);

  const ix = [];
  const toInfo = await getConn().getAccountInfo(toAta);
  if(!toInfo){
    ix.push(splToken.createAssociatedTokenAccountInstruction(
      fromPk, toAta, toPk, mint
    ));
  }
  const dec = 6; // USDT
  const qty = BigInt(Math.round(amount * 10**dec));
  ix.push(splToken.createTransferInstruction(fromAta, toAta, fromPk, qty));

  const tx = new solanaWeb3.Transaction().add(...ix);
  tx.feePayer = fromPk;
  tx.recentBlockhash = (await getConn().getLatestBlockhash()).blockhash;

  const signed = await provider.signAndSendTransaction(tx);
  alert("Gönderildi! TX: "+(signed.signature||signed));
}

document.getElementById("sendSOL")?.addEventListener("click", sendSOL);
document.getElementById("sendUSDT")?.addEventListener("click", sendUSDT);

// Ticker görünürlük küçük hack
(function ensureTickerVisible(){
  const track=document.getElementById('exTrack'); if(!track) return;
  track.style.willChange='transform'; track.style.transform='translateX(0)'; setTimeout(()=>{ track.style.transform=''; },50);
})();
</script>

</body>
</html>
