<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ZUZU – Admin</title>
<style>
body{background:#070c1a;color:#eaf2ff;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0}
.wrap{max-width:980px;margin:20px auto;padding:0 14px}
.card{background:#0e1836;border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:14px}
.btn{background:#173061;color:#fff;border:0;padding:10px 14px;border-radius:10px;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:10px}
td,th{border-bottom:1px solid rgba(255,255,255,.08);padding:8px;font-size:14px}
small{color:#9fb5dd}
</style>
</head>
<body>
<div class="wrap">
  <h2>ZUZU • Admin</h2>
  <div class="card">
    <button id="btnConnect" class="btn">Cüzdan Bağla</button>
    <div id="me" style="margin-top:8px"></div>
    <p><small>Gösterilenler: USDT (BEP20) → Receiver transferleri (son ~50k blok içinde).</small></p>
  </div>

  <div class="card" style="margin-top:12px">
    <h3>Son İşlemler</h3>
    <table>
      <thead><tr><th>Tx</th><th>From</th><th>To</th><th>Amount (USDT)</th><th>Block</th></tr></thead>
      <tbody id="rows"></tbody>
    </table>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<script>
// Aynı config buraya gömüldü (receiver/admin/usdt)
const CFG={ ADMIN_ADDRESS:"0x69014a76Ee25c8B73dAe9044dfcAd7356fe74bC3",
            USDT:"0x55d398326f99059fF775485246999027B3197955",
            RECEIVER:"0x69014a76Ee25c8B73dAe9044dfcAd7356fe74bC3" };

let provider, signer, me;

const short=a=>a.slice(0,6)+'…'+a.slice(-4);

async function connect(){
  if(!window.ethereum) return alert('MetaMask/TrustWallet gerekli.');
  provider=new ethers.providers.Web3Provider(window.ethereum,'any');
  await provider.send('eth_requestAccounts',[]); signer=provider.getSigner(); me=await signer.getAddress();
  const net=await provider.getNetwork(); if(net.chainId!==56){ try{await provider.send('wallet_switchEthereumChain',[{chainId:'0x38'}]);}catch(_){} }
  document.getElementById('me').textContent='Cüzdan: '+me+(me.toLowerCase()===CFG.ADMIN_ADDRESS.toLowerCase()?' (ADMIN)':' (yetkisiz)');
  if(me.toLowerCase()!==CFG.ADMIN_ADDRESS.toLowerCase()) return alert('Admin değilsin.');
  await loadLogs();
}

async function loadLogs(){
  const rows=document.getElementById('rows'); rows.innerHTML='Yükleniyor…';
  try{
    const latest=await provider.getBlockNumber();
    const fromBlock=Math.max(1, latest-50000);
    const topicTransfer=ethers.utils.id("Transfer(address,address,uint256)");
    const toTopic="0x000000000000000000000000"+CFG.RECEIVER.toLowerCase().slice(2);
    const logs=await provider.getLogs({fromBlock,toBlock:'latest',address:CFG.USDT,topics:[topicTransfer,null,toTopic]});
    rows.innerHTML='';
    const iface=new ethers.utils.Interface(["event Transfer(address indexed from,address indexed to,uint256 value)"]);
    logs.slice(-100).reverse().forEach(l=>{
      const p=iface.parseLog(l);
      const amt=Number(ethers.utils.formatUnits(p.args.value,18));
      const tr=`<tr><td><a target="_blank" href="https://bscscan.com/tx/${l.transactionHash}">${l.transactionHash.slice(0,10)}…</a></td>
                <td>${short(p.args.from)}</td><td>${short(p.args.to)}</td><td>${amt.toFixed(6)}</td><td>${l.blockNumber}</td></tr>`;
      rows.insertAdjacentHTML('beforeend',tr);
    });
    if(!logs.length) rows.innerHTML='<tr><td colspan="5">Kayıt yok.</td></tr>';
  }catch(e){console.error(e); rows.innerHTML='<tr><td colspan="5">Hata / RPC sınırlandı.</td></tr>';}
}
document.getElementById('btnConnect').addEventListener('click',connect);
</script>
</body>
</html>
